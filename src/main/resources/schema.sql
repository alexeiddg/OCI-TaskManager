create table app_user (created_at timestamp(6), id number(19,0) generated by default as identity, manager_id number(19,0), team_id number(19,0), updated_at timestamp(6), role varchar2(20 char) not null check (role in ('MANAGER','DEVELOPER')), username varchar2(50 char) not null unique, email varchar2(100 char) unique, name varchar2(100 char) not null, password varchar2(255 char) not null, telegram_id varchar2(255 char) unique, primary key (id));
create table kpi_snapshots (value float(53) not null, id number(19,0) generated by default as identity, recorded_at timestamp(6) not null, sprint_id number(19,0), team_id number(19,0), user_id number(19,0), kpi_type varchar2(255 char) not null check (kpi_type in ('SPRINT_VELOCITY','SPRINT_COMPLETION_RATE','BUGS_VS_FEATURES_RATIO','EFFICIENCY_SCORE','WORKLOAD_BALANCE','AVERAGE_COMPLETION_TIME')), primary key (id));
create table project_favorites (id number(19,0) generated by default as identity, project_id number(19,0) not null, user_id number(19,0) not null, primary key (id));
create table projects (is_active number(1,0) check (is_active in (0,1)), created_at timestamp(6), id number(19,0) generated by default as identity, manager_id number(19,0) not null, team_id number(19,0) not null, updated_at timestamp(6), project_name varchar2(150 char) not null, project_description varchar2(500 char) not null, primary key (id));
create table sprints (is_active number(1,0) check (is_active in (0,1)), status number(3,0) check (status between 0 and 3), created_at timestamp(6) not null, end_date timestamp(6) not null, id number(19,0) generated by default as identity, project_id number(19,0) not null, start_date timestamp(6) not null, updated_at timestamp(6), sprint_description TEXT, sprint_name varchar2(255 char) not null, primary key (id));
create table task_audit (audit_id number(19,0) generated by default as identity, changed_at timestamp(6) not null, changed_by number(19,0) not null, task_id number(19,0) not null, change_type varchar2(20 char) not null check (change_type in ('CREATE','UPDATE','DELETE','STATUS_CHANGE','ASSIGNMENT_CHANGE')), new_status varchar2(20 char) check (new_status in ('TODO','IN_PROGRESS','DONE')), old_status varchar2(20 char) check (old_status in ('TODO','IN_PROGRESS','DONE')), change_comment varchar2(2000 char), primary key (audit_id));
create table task_favorites (favorited_at timestamp(6) not null, id number(19,0) generated by default as identity, task_id number(19,0) not null, user_id number(19,0) not null, primary key (id));
create table task_logs (hours_logged float(53) not null, id number(19,0) generated by default as identity, log_date timestamp(6) not null, task_id number(19,0) not null, user_id number(19,0) not null, primary key (id));
create table tasks (blocked number(1,0) not null check (blocked in (0,1)), is_active number(1,0) not null check (is_active in (0,1)), story_points number(10,0) not null, assigned_to number(19,0), completed_at timestamp(6), created_at timestamp(6) not null, created_by number(19,0), due_date timestamp(6), id number(19,0) generated by default as identity, sprint_id number(19,0) not null, updated_at timestamp(6), priority varchar2(20 char) not null check (priority in ('LOW','MEDIUM','HIGH')), status varchar2(20 char) not null check (status in ('TODO','IN_PROGRESS','DONE')), type varchar2(20 char) not null check (type in ('BUG','FEATURE','IMPROVEMENT')), task_name varchar2(100 char) not null, task_description TEXT not null, primary key (id));
create table teams (is_active number(1,0) check (is_active in (0,1)), created_at timestamp(6), id number(19,0) generated by default as identity, manager_id number(19,0), updated_at timestamp(6), team_name varchar2(100 char) not null unique, primary key (id));
alter table app_user add constraint FKa6wtdhdijrq38p4cqw03ywfn6 foreign key (manager_id) references app_user;
alter table app_user add constraint FK8mkow04fllrvy2vq04lbmvowp foreign key (team_id) references teams;
alter table kpi_snapshots add constraint FK2fyscgua96mmaijopn9515kjw foreign key (sprint_id) references sprints;
alter table kpi_snapshots add constraint FK5upja0do4gedq9r16vbyl0t9i foreign key (team_id) references teams;
alter table kpi_snapshots add constraint FKd6k4hggekd41aaosmcq9ubf8f foreign key (user_id) references app_user;
alter table project_favorites add constraint FKou33ap52w7r0gpvltur3ypta6 foreign key (project_id) references projects;
alter table project_favorites add constraint FKo1s586xsg0km5bk5e5qsm6b4a foreign key (user_id) references app_user;
alter table projects add constraint FKcjmfvpl3efis2cw2di6lpfhi5 foreign key (manager_id) references app_user;
alter table projects add constraint FKmqih0928bq6r3gbuh47giq8w foreign key (team_id) references teams;
alter table sprints add constraint FKke5a9e380ibc0xugykeqaktp4 foreign key (project_id) references projects;
alter table task_audit add constraint FK6ip2ac0fccsbekvjl8aqft56s foreign key (changed_by) references app_user;
alter table task_audit add constraint FKm1g33rkbsrm8f10uqvifpx49f foreign key (task_id) references tasks;
alter table task_favorites add constraint FKhux828xcxi35bndh54ap95uqs foreign key (task_id) references tasks;
alter table task_favorites add constraint FKr5qhafbas54726rnrac4x3yme foreign key (user_id) references app_user;
alter table task_logs add constraint FKslumv6el85ys5ytniacscgusp foreign key (task_id) references tasks;
alter table task_logs add constraint FKquwu4egaoo5vpnoonms7hbcn6 foreign key (user_id) references app_user;
alter table tasks add constraint FKp42oualsdiigxp194wcv81e4x foreign key (assigned_to) references app_user;
alter table tasks add constraint FKqugda6qy289m7t2gyq4pcuh3t foreign key (created_by) references app_user;
alter table tasks add constraint FKl5ac6kwptw5o73haren9qnkav foreign key (sprint_id) references sprints;
alter table teams add constraint FKs677m9q5g8v41ht1nystvakcv foreign key (manager_id) references app_user;
